name: Build and Deploy to Vercel

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci

      - name: Type check
        working-directory: ./frontend
        run: npx tsc --noEmit || true

      - name: Build
        working-directory: ./frontend
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL || 'https://aacxwlbetyodwiohlpmr.supabase.co' }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhY3h3bGJldHlvZHdpb2hscG1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MjUxOTYsImV4cCI6MjA4NjIwMTE5Nn0.d8il8guNV0F2Wd7bez-bb75jyMSfGTTImjzn1_0vm38' }}
          VITE_SITE_URL: ${{ secrets.VITE_SITE_URL || 'https://flatwithoutbrokerage.com' }}
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist
          retention-days: 7

  # Note: Vercel will automatically deploy when connected to GitHub
  # This workflow is for CI/CD validation only
  # Configure Vercel deployment in Vercel dashboard:
  # 1. Connect your GitHub repository
  # 2. Set root directory to: frontend
  # 3. Framework: Vite
  # 4. Build command: npm run build
  # 5. Output directory: dist
  # 6. Add environment variables in Vercel dashboard:
  #    - VITE_SUPABASE_URL
  #    - VITE_SUPABASE_ANON_KEY
  #    - VITE_SITE_URL
